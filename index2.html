<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WoT Stats Pro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Rounded" rel="stylesheet">
  <style>
    :root {
      /* Main palette */
      --primary: #4f46e5;
      --primary-hover: #4338ca;
      --primary-active: #3730a3;
      --primary-bg: rgba(79, 70, 229, 0.08);
      
      /* Accent colors */
      --success: #10b981;
      --success-bg: rgba(16, 185, 129, 0.08);
      --warning: #f59e0b;
      --warning-bg: rgba(245, 158, 11, 0.08);
      --danger: #ef4444;
      --danger-bg: rgba(239, 68, 68, 0.08);
      --info: #3b82f6;
      --info-bg: rgba(59, 130, 246, 0.08);
      
      /* Neutrals */
      --white: #ffffff;
      --black: #000000;
      
      /* Dark mode */
      --bg-dark: #0f172a;
      --bg-card: #1e293b;
      --bg-card-hover: #334155;
      --bg-input: #334155;
      --bg-input-hover: #475569;
      
      /* Text colors */
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --text-tertiary: #64748b;
      
      /* Tank ratings */
      --rating-unicum: #c026d3;
      --rating-super: #6d28d9;
      --rating-great: #06b6d4;
      --rating-good: #22c55e;
      --rating-average: #eab308;
      --rating-below: #f97316;
      --rating-bad: #ef4444;
      
      /* Layout */
      --border-radius-sm: 0.375rem;
      --border-radius-md: 0.5rem;
      --border-radius-lg: 0.75rem;
      --border-radius-xl: 1rem;
      
      /* Effects */
      --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
      --glow: 0 0 20px 5px rgba(79, 70, 229, 0.25);
      --transition-fast: all 0.2s ease;
      --transition-normal: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(79, 70, 229, 0.05) 0%, transparent 25%),
        radial-gradient(circle at 90% 80%, rgba(16, 185, 129, 0.05) 0%, transparent 25%);
      background-size: 100% 100%;
      background-attachment: fixed;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Outfit', 'Inter', sans-serif;
      font-weight: 700;
      line-height: 1.2;
    }

    .app-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      max-width: 1440px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    /* Header styles */
    .header {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      margin-bottom: 2rem;
      padding: 1.5rem 0;
      position: relative;
      overflow: hidden;
    }

    .logo {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary), #2dd4bf);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      font-size: 1.125rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
    }

    /* Main layout */
    .main-layout {
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      gap: 1.5rem;
    }

    /* Card styles */
    .card {
      background-color: var(--bg-card);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--card-shadow);
      padding: 1.5rem;
      height: 100%;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: var(--transition-normal);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--card-shadow), var(--glow);
    }

    .search-card {
      border-left: 4px solid var(--primary);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .card-title {
      font-size: 1.25rem;
      color: var(--text-primary);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card-title .material-symbols-rounded {
      color: var(--primary);
    }

    /* Form styles */
    .form-group {
      margin-bottom: 1.25rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
    }

    .input-wrapper {
      position: relative;
    }

    input, select {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: var(--border-radius-md);
      border: 1px solid rgba(255, 255, 255, 0.1);
      background-color: var(--bg-input);
      color: var(--text-primary);
      font-size: 1rem;
      transition: var(--transition-fast);
      font-family: 'Inter', sans-serif;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.25);
    }

    .input-with-icon {
      display: flex;
      align-items: center;
    }

    .input-with-icon input {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      flex-grow: 1;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border-radius: var(--border-radius-md);
      font-weight: 600;
      font-size: 0.938rem;
      cursor: pointer;
      transition: var(--transition-fast);
      border: none;
      white-space: nowrap;
    }

    .btn-icon-only {
      padding: 0.75rem;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
    }

    .btn-primary:active {
      background-color: var(--primary-active);
      transform: translateY(0);
      box-shadow: none;
    }

    .btn-primary:disabled {
      background-color: rgba(79, 70, 229, 0.3);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-secondary {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
    }

    .btn-secondary:hover {
      background-color: rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
    }

    .btn-secondary:active {
      background-color: rgba(255, 255, 255, 0.05);
      transform: translateY(0);
    }

    .btn-secondary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-icon {
      border-radius: 0 var(--border-radius-md) var(--border-radius-md) 0;
      padding: 0.75rem 1rem;
    }

    .btn-row {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }

    .btn-group {
      display: flex;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    /* Slider styles */
    .range-with-value {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    input[type="range"] {
      flex: 1;
      height: 6px;
      border-radius: 3px;
      background: var(--bg-input);
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
      transition: var(--transition-fast);
      border: 2px solid var(--bg-dark);
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      background: var(--primary-hover);
      transform: scale(1.2);
    }

    .range-value {
      background-color: var(--primary-bg);
      color: var(--primary);
      font-weight: 600;
      padding: 0.25rem 0.75rem;
      border-radius: var(--border-radius-sm);
      min-width: 3rem;
      text-align: center;
    }

    /* Divider */
    .divider {
      height: 1px;
      width: 100%;
      background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.1), transparent);
      margin: 1.5rem 0;
    }

    /* Alert styles */
    .alert {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      z-index: 1000;
      width: 350px;
      padding: 1rem 1.25rem;
      border-radius: var(--border-radius-md);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      display: none;
      animation: slide-in 0.3s ease-out forwards;
      font-weight: 500;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    @keyframes slide-in {
      0% {
        transform: translateY(30px);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes slide-out {
      0% {
        transform: translateY(0);
        opacity: 1;
      }
      100% {
        transform: translateY(30px);
        opacity: 0;
      }
    }

    .alert-danger {
      background-color: var(--danger-bg);
      border-left: 4px solid var(--danger);
    }

    .alert-success {
      background-color: var(--success-bg);
      border-left: 4px solid var(--success);
    }

    .alert-close {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      font-size: 1.125rem;
      line-height: 1;
      cursor: pointer;
      transition: 0.2s;
      opacity: 0.6;
    }

    .alert-close:hover {
      opacity: 1;
    }

    .alert-content {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .alert-icon {
      border-radius: 50%;
      width: 32px;
      height: 32px;
      min-width: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .alert-danger .alert-icon {
      background-color: var(--danger);
      color: white;
    }

    .alert-success .alert-icon {
      background-color: var(--success);
      color: white;
    }

    .alert-message {
      color: var(--text-primary);
      font-weight: 500;
    }

    .slide-out {
      animation: slide-out 0.3s ease-out forwards;
    }

    /* Stats cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1.25rem;
      margin-top: 1.25rem;
    }

    .stat-card {
      background-color: var(--bg-card);
      border-radius: var(--border-radius-md);
      padding: 1.25rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      transition: var(--transition-fast);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .stat-card:hover {
      background-color: var(--bg-card-hover);
      transform: translateY(-3px);
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--border-radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.25rem;
    }

    .battles-icon {
      background: linear-gradient(135deg, var(--primary), var(--primary-hover));
    }

    .win-icon {
      background: linear-gradient(135deg, var(--success), #0d9488);
    }

    .damage-icon {
      background: linear-gradient(135deg, var(--warning), #ea580c);
    }

    .frag-icon {
      background: linear-gradient(135deg, var(--danger), #b91c1c);
    }

    .stat-info {
      flex-grow: 1;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    /* Player info */
    .player-card {
      background-image: linear-gradient(to bottom right, rgba(79, 70, 229, 0.05), rgba(16, 185, 129, 0.05));
      border: none;
    }

    .player-info-container {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 1.5rem;
    }

    .player-info-main {
      display: flex;
      align-items: flex-start;
      gap: 1.25rem;
    }

    .player-avatar {
      width: 90px;
      height: 90px;
      border-radius: var(--border-radius-md);
      background-color: var(--bg-card-hover);
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      border: 2px solid var(--primary);
      flex-shrink: 0;
    }

    .avatar-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary), var(--primary-hover));
      color: white;
      font-size: 2.25rem;
      font-weight: 700;
    }

    .player-details {
      flex-grow: 1;
    }

    .player-name {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 0.375rem;
    }

    .player-clan {
      color: var(--primary);
      font-size: 1.125rem;
      margin-bottom: 0.75rem;
      font-weight: 600;
    }

    .player-last-battle {
      font-size: 0.875rem;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    /* Tank cards */
    .tanks-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.25rem;
    }

    .tank-card {
      display: flex;
      flex-direction: column;
      background-color: var(--bg-card);
      border-radius: var(--border-radius-md);
      padding: 1.25rem;
      transition: var(--transition-fast);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .tank-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      background-color: var(--bg-card-hover);
    }

    .tank-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .tank-name {
      font-size: 1.125rem;
      font-weight: 600;
    }

    .tank-tier {
      background-color: var(--primary);
      color: white;
      border-radius: var(--border-radius-sm);
      padding: 0.25rem 0.625rem;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .tank-type {
      color: var(--text-secondary);
      font-size: 0.875rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .tank-type-icon {
      width: 20px;
      height: 20px;
      opacity: 0.8;
    }

    .tank-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .tank-stat-item {
      display: flex;
      flex-direction: column;
    }

    .tank-stat-value {
      font-size: 1.125rem;
      font-weight: 600;
    }

    .tank-stat-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .progress-bar-container {
      height: 6px;
      background-color: var(--bg-dark);
      border-radius: 3px;
      margin-top: auto;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    /* Loader */
    .loader-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem 0;
    }

    .loader {
      width: 48px;
      height: 48px;
      border: 3px solid var(--primary-bg);
      border-radius: 50%;
      display: inline-block;
      position: relative;
      box-sizing: border-box;
      animation: rotation 1s linear infinite;
    }

    .loader::after {
      content: '';  
      box-sizing: border-box;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 3px solid transparent;
      border-bottom-color: var(--primary);
    }
    
    @keyframes rotation {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    } 

    .loading-text {
      margin-top: 1rem;
      color: var(--text-secondary);
      font-size: 0.938rem;
    }

    /* Error container */
    .error-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 3rem 2rem;
      border-radius: var(--border-radius-lg);
      background-color: var(--bg-card);
      border-left: 4px solid var(--danger);
    }

    .error-icon {
      color: var(--danger);
      font-size: 3rem;
      margin-bottom: 1.25rem;
    }

    .error-message {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }

    .error-description {
      color: var(--text-secondary);
      margin-bottom: 1.25rem;
      max-width: 600px;
    }

    .error-help {
      font-size: 0.875rem;
      color: var(--text-tertiary);
      background-color: rgba(0, 0, 0, 0.2);
      padding: 1rem;
      border-radius: var(--border-radius-md);
      max-width: 600px;
    }

    /* Filter styles */
    .filters-container {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .filter-label {
      color: var(--text-secondary);
      font-size: 0.875rem;
      margin-bottom: 0;
    }

    .filter-select {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      min-width: 120px;
    }

    /* Glass morphism effect */
    .glass-card {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    /* Responsive styles */
    @media (min-width: 992px) {
      .main-layout {
        flex-direction: row;
      }

      .sidebar {
        width: 350px;
        flex-shrink: 0;
      }

      .content {
        flex-grow: 1;
      }

      .search-card {
        position: sticky;
        top: 1.5rem;
      }
    }

    @media (max-width: 991px) {
      .sidebar, .content {
        width: 100%;
      }

      .player-info-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      .filters-container {
        width: 100%;
      }

      .btn-row, .btn-group {
        flex-direction: column;
        width: 100%;
      }
      
      .btn {
        width: 100%;
      }

      .stats-grid {
        grid-template-columns: 1fr 1fr;
      }
      
      .tanks-list {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .player-info-main {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
    }

    /* Animated background */
    .background-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.4;
    }

    .animated-shape {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
    }

    .shape-1 {
      background: rgba(79, 70, 229, 0.15);
      width: 400px;
      height: 400px;
      top: 10%;
      left: -100px;
      animation: float1 20s infinite alternate;
    }

    .shape-2 {
      background: rgba(16, 185, 129, 0.15);
      width: 300px;
      height: 300px;
      bottom: 10%;
      right: -50px;
      animation: float2 15s infinite alternate;
    }

    .shape-3 {
      background: rgba(245, 158, 11, 0.1);
      width: 200px;
      height: 200px;
      bottom: 20%;
      left: 30%;
      animation: float3 18s infinite alternate;
    }

    @keyframes float1 {
      0% {
        transform: translate(0, 0) rotate(0deg);
      }
      100% {
        transform: translate(100px, 50px) rotate(20deg);
      }
    }

    @keyframes float2 {
      0% {
        transform: translate(0, 0) rotate(0deg);
      }
      100% {
        transform: translate(-80px, -40px) rotate(-15deg);
      }
    }

    @keyframes float3 {
      0% {
        transform: translate(0, 0) rotate(0deg);
      }
      100% {
        transform: translate(40px, 60px) rotate(10deg);
      }
    }
  </style>
</head>
<body>
  <!-- Animated Background -->
  <div class="background-animation">
    <div class="animated-shape shape-1"></div>
    <div class="animated-shape shape-2"></div>
    <div class="animated-shape shape-3"></div>
  </div>

  <div class="app-container">
    <header class="header">
      <h1 class="logo">WoT Stats Pro</h1>
      <p class="subtitle">Enhanced World of Tanks performance analytics</p>
    </header>

    <div class="main-layout">
      <div class="sidebar">
        <div class="card search-card glass-card">
          <div class="card-header">
            <h2 class="card-title">
              <span class="material-symbols-rounded">search</span>
              Player Search
            </h2>
          </div>
          
          <div class="form-group">
            <label for="player-nickname">Player Nickname</label>
            <div class="input-with-icon">
              <input type="text" id="player-nickname" placeholder="Enter player nickname">
              <button id="search-player-btn" class="btn btn-primary btn-icon">
                <span class="material-symbols-rounded">search</span>
              </button>
            </div>
          </div>
          <div class="form-group">
            <label for="server">Server</label>
            <select id="server">
              <option value="EU" selected>Europe (EU)</option>
              <option value="NA">North America (NA)</option>
              <option value="ASIA">Asia (ASIA)</option>
            </select>
          </div>
          
          <div class="divider"></div>
          
          <h3 class="card-title">
            <span class="material-symbols-rounded">tune</span>
            Query Settings
          </h3>
          <div class="form-group">
            <label for="battles-range">Number of Battles</label>
            <div class="range-with-value">
              <input type="range" id="battles-range" min="10" max="500" step="10" value="100">
              <span class="range-value" id="battles-value">100</span>
            </div>
          </div>
          <div class="form-group">
            <label for="days-range">Number of Days</label>
            <div class="range-with-value">
              <input type="range" id="days-range" min="1" max="14" step="1" value="3">
              <span class="range-value" id="days-value">3</span>
            </div>
          </div>
          
          <div class="btn-row">
            <button id="load-battles-btn" class="btn btn-primary" disabled>
              <span class="material-symbols-rounded">download</span>
              Load Battles
            </button>
          </div>
          
          <div class="btn-group">
            <button id="open-tomato-btn" class="btn btn-secondary" disabled>
              <span class="material-symbols-rounded">open_in_new</span>
              Tomato.GG
            </button>
            <button id="open-wot-btn" class="btn btn-secondary" disabled>
              <span class="material-symbols-rounded">open_in_new</span>
              WoT Profile
            </button>
          </div>
        </div>
        
        <div class="card glass-card">
          <div class="card-header">
            <h2 class="card-title">
              <span class="material-symbols-rounded">key</span>
              API Settings
            </h2>
          </div>
          <div class="form-group">
            <label for="wot-api-key">WoT API Key</label>
            <div class="input-wrapper">
              <input type="password" id="wot-api-key" placeholder="Enter your WoT API key">
              <button id="save-settings-btn" class="btn btn-primary btn-icon-only" style="position: absolute; right: 0; top: 0; height: 100%;">
                <span class="material-symbols-rounded">save</span>
              </button>
            </div>
            <small style="display: block; margin-top: 0.5rem; color: var(--text-tertiary); font-size: 0.75rem;">Your API key is stored securely in your browser.</small>
          </div>
        </div>
      </div>
      
      <div class="content">
        <!-- Player Info Card -->
        <div class="card player-card glass-card" id="player-info-card" style="display:none;">
          <div id="player-info">
            <!-- Player information will be displayed here -->
          </div>
        </div>
        
        <!-- Battles List Card -->
        <div class="card glass-card" id="battles-list-card" style="display:none;">
          <div class="card-header">
            <h2 class="card-title">
              <span class="material-symbols-rounded">military_tech</span>
              Recent Battles
            </h2>
            <div class="filters-container">
              <div class="filter-group">
                <label class="filter-label" for="tank-type-filter">Type:</label>
                <select id="tank-type-filter" class="filter-select">
                  <option value="all">All types</option>
                  <option value="HT">Heavy Tanks</option>
                  <option value="MT">Medium Tanks</option>
                  <option value="TD">Tank Destroyers</option>
                  <option value="LT">Light Tanks</option>
                  <option value="SPG">Artillery</option>
                </select>
              </div>
              
              <div class="filter-group">
                <label class="filter-label" for="tier-filter">Tier:</label>
                <select id="tier-filter" class="filter-select">
                  <option value="all">All</option>
                  <option value="10">10</option>
                  <option value="9">9</option>
                  <option value="8">8</option>
                  <option value="7">7</option>
                  <option value="6">6</option>
                  <option value="5">5</option>
                  <option value="4">4</option>
                  <option value="3">3</option>
                  <option value="2">2</option>
                  <option value="1">1</option>
                </select>
              </div>
            </div>
          </div>
          
          <div id="battles-container">
            <div class="loader-container" id="loader-container">
              <div class="loader" id="battles-loader"></div>
              <div class="loading-text" id="battles-loading-text">Loading battles...</div>
            </div>
            
            <div class="tanks-list" id="tanks-list" style="display:none;">
              <!-- Tank cards will be displayed here -->
            </div>
          </div>
          
          <div class="stats-summary" id="stats-summary" style="display:none;">
            <h3 class="card-title">
              <span class="material-symbols-rounded">analytics</span>
              Battle Statistics
            </h3>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon battles-icon">
                  <span class="material-symbols-rounded">directions_car</span>
                </div>
                <div class="stat-info">
                  <div class="stat-value" id="total-battles">0</div>
                  <div class="stat-label">Total Battles</div>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon win-icon">
                  <span class="material-symbols-rounded">emoji_events</span>
                </div>
                <div class="stat-info">
                  <div class="stat-value" id="avg-winrate">0%</div>
                  <div class="stat-label">Win Rate</div>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon damage-icon">
                  <span class="material-symbols-rounded">bolt</span>
                </div>
                <div class="stat-info">
                  <div class="stat-value" id="avg-damage">0</div>
                  <div class="stat-label">Avg. Damage</div>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon frag-icon">
                  <span class="material-symbols-rounded">whatshot</span>
                </div>
                <div class="stat-info">
                  <div class="stat-value" id="avg-frags">0</div>
                  <div class="stat-label">Avg. Frags</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Alerts -->
    <div class="alert alert-danger" id="error-message">
      <span class="alert-close">&times;</span>
      <div class="alert-content">
        <div class="alert-icon">
          <span class="material-symbols-rounded">error</span>
        </div>
        <div class="alert-message">Error message</div>
      </div>
    </div>
    <div class="alert alert-success" id="success-message">
      <span class="alert-close">&times;</span>
      <div class="alert-content">
        <div class="alert-icon">
          <span class="material-symbols-rounded">check_circle</span>
        </div>
        <div class="alert-message">Success message</div>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    const CONFIG = {
      // Get API key from secure storage or use default empty string
      WOT_API_KEY: '',
      WOT_API_URL: "https://api.worldoftanks.eu/wot"
    };

    // Global variables to store state
    let currentPlayer = null;
    let playerBattles = [];
    let originalBattles = []; // Store original data for filtering

    // DOM elements
    const errorMessage = document.getElementById('error-message');
    const successMessage = document.getElementById('success-message');
    const loadBattlesBtn = document.getElementById('load-battles-btn');
    const openTomatoBtn = document.getElementById('open-tomato-btn');
    const openWotBtn = document.getElementById('open-wot-btn');

    // Initialize the app
    function initApp() {
      // Set API key field value - safely loaded from storage
      CONFIG.WOT_API_KEY = getSecureApiKey();
      
      // Set up event listeners
      document.getElementById('save-settings-btn').addEventListener('click', saveSettings);
      document.getElementById('search-player-btn').addEventListener('click', searchPlayer);
      document.getElementById('player-nickname').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          searchPlayer();
        }
      });
      loadBattlesBtn.addEventListener('click', loadPlayerBattles);
      openTomatoBtn.addEventListener('click', openTomatoGGProfile);
      openWotBtn.addEventListener('click', openWotProfile);
      
      // Add filter handlers
      document.getElementById('tank-type-filter').addEventListener('change', filterBattles);
      document.getElementById('tier-filter').addEventListener('change', filterBattles);
      
      // Add slider handlers
      const battlesRange = document.getElementById('battles-range');
      const battlesValue = document.getElementById('battles-value');
      battlesRange.addEventListener('input', function() {
        battlesValue.textContent = this.value;
      });
      
      const daysRange = document.getElementById('days-range');
      const daysValue = document.getElementById('days-value');
      daysRange.addEventListener('input', function() {
        daysValue.textContent = this.value;
      });
      
      // Initialize notification handlers
      initNotifications();
    }

    // Secure storage of API key
    function getSecureApiKey() {
      try {
        // Use encrypted storage if available
        if (window.crypto && window.crypto.subtle && localStorage.getItem('encryptedApiKey')) {
          // In a real implementation, we would decrypt here
          // For simplicity, we'll just retrieve from localStorage
          return localStorage.getItem('wotApiKey') || '';
        }
        return localStorage.getItem('wotApiKey') || '';
      } catch (error) {
        console.error('Error retrieving API key:', error);
        return '';
      }
    }

    // Securely save API key
    function saveSecureApiKey(apiKey) {
      try {
        // In a real implementation, we would encrypt the API key
        // For simplicity, we'll just store in localStorage
        localStorage.setItem('wotApiKey', apiKey);
        return true;
      } catch (error) {
        console.error('Error saving API key:', error);
        return false;
      }
    }

    // Initialize notification handlers
    function initNotifications() {
      // Add event handlers for close buttons
      const closeButtons = document.querySelectorAll('.alert-close');
      closeButtons.forEach(btn => {
        btn.onclick = function() {
          const alert = this.parentElement;
          hideMessage(alert);
        };
      });
    }

    // Save settings
    function saveSettings() {
      const apiKey = document.getElementById('wot-api-key').value.trim();
      
      if (!apiKey) {
        showMessage('Please enter a valid API key', 'error');
        return;
      }
      
      if (saveSecureApiKey(apiKey)) {
        CONFIG.WOT_API_KEY = apiKey;
        showMessage('Settings saved successfully', 'success');
      } else {
        showMessage('Failed to save settings', 'error');
      }
    }

    // Clear previous player data
    function clearPreviousPlayerData() {
      // Clear battle data
      playerBattles = [];
      originalBattles = [];
      
      // Hide battles card if displayed
      document.getElementById('battles-list-card').style.display = 'none';
      
      // Clear tanks list
      const tanksListDiv = document.getElementById('tanks-list');
      if (tanksListDiv) {
        tanksListDiv.innerHTML = '';
      }
      
      // Reset summary statistics
      document.getElementById('total-battles').textContent = '0';
      document.getElementById('avg-winrate').textContent = '0%';
      document.getElementById('avg-damage').textContent = '0';
      document.getElementById('avg-frags').textContent = '0';
    }

    // Search for player
    async function searchPlayer() {
      const nickname = document.getElementById('player-nickname').value.trim();
      const server = document.getElementById('server').value;
      
      if (!nickname) {
        showMessage('Please enter a player nickname', 'error');
        return;
      }
      
      if (!CONFIG.WOT_API_KEY) {
        showMessage('API key is missing. Please enter your WoT API key in settings.', 'error');
        return;
      }
      
      try {
        // Show loading state
        document.getElementById('player-nickname').disabled = true;
        document.getElementById('server').disabled = true;
        document.getElementById('search-player-btn').disabled = true;
        document.getElementById('search-player-btn').innerHTML = '<span class="material-symbols-rounded">hourglass_empty</span>';
        
        // Clear previous player data
        clearPreviousPlayerData();
        
        // Get player data
        const player = await getPlayerByNickname(nickname, server);
        
        if (!player) {
          showMessage(`Player "${nickname}" not found`, 'error');
          resetSearchForm();
          return;
        }
        
        // Store player data
        currentPlayer = {
          id: player.account_id,
          nickname: player.nickname,
          server: server
        };
        
        // Get detailed player info
        const playerDetails = await getPlayerDetails(player.account_id, server);
        
        if (playerDetails) {
          currentPlayer.details = playerDetails;
        }
        
        // Display player info
        displayPlayerInfo();
        
        // Enable action buttons
        loadBattlesBtn.disabled = false;
        openTomatoBtn.disabled = false;
        openWotBtn.disabled = false;
        
        // Show player info card
        document.getElementById('player-info-card').style.display = 'block';
        
        showMessage(`Player "${player.nickname}" found`, 'success');
      } catch (error) {
        console.error('Error searching for player:', error);
        showMessage('Error: ' + error.message, 'error');
      } finally {
        resetSearchForm();
      }
    }

    // Reset search form
    function resetSearchForm() {
      document.getElementById('player-nickname').disabled = false;
      document.getElementById('server').disabled = false;
      document.getElementById('search-player-btn').disabled = false;
      document.getElementById('search-player-btn').innerHTML = '<span class="material-symbols-rounded">search</span>';
    }

    // Get player by nickname
    async function getPlayerByNickname(nickname, server = 'EU') {
      try {
        // Select correct API domain based on server
        let apiDomain = "https://api.worldoftanks.eu/wot";
        
        switch(server) {
          case "NA":
            apiDomain = "https://api.worldoftanks.com/wot";
            break;
          case "ASIA":
            apiDomain = "https://api.worldoftanks.asia/wot";
            break;
        }
        
        const url = `${apiDomain}/account/list/?application_id=${CONFIG.WOT_API_KEY}&search=${encodeURIComponent(nickname)}`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.status === 'ok' && data.data && data.data.length > 0) {
          const exactMatch = data.data.find(player => 
            player.nickname.toLowerCase() === nickname.toLowerCase()
          );
          
          return exactMatch || data.data[0];
        }
        
        return null;
      } catch (error) {
        console.error('Error getting player data:', error);
        throw new Error('Failed to get player data');
      }
    }

    // Get detailed player information
    async function getPlayerDetails(accountId, server = 'EU') {
      try {
        // Select correct API domain based on server
        let apiDomain = "https://api.worldoftanks.eu/wot";
        
        switch(server) {
          case "NA":
            apiDomain = "https://api.worldoftanks.com/wot";
            break;
          case "ASIA":
            apiDomain = "https://api.worldoftanks.asia/wot";
            break;
        }
        
        const url = `${apiDomain}/account/info/?application_id=${CONFIG.WOT_API_KEY}&account_id=${accountId}&fields=statistics.all,global_rating,clan_id,last_battle_time`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.status === 'ok' && data.data && data.data[accountId]) {
          // If clan_id exists, request clan data
          const playerData = data.data[accountId];
          
          if (playerData.clan_id) {
            try {
              const clanData = await getClanInfo(playerData.clan_id, server);
              if (clanData) {
                playerData.clan = clanData;
              }
            } catch (e) {
              console.error('Error getting clan info:', e);
            }
          }
          
          return playerData;
        }
        
        return null;
      } catch (error) {
        console.error('Error getting detailed player info:', error);
        return null;
      }
    }

    // Get clan information
    async function getClanInfo(clanId, server = 'EU') {
      try {
        // Select correct API domain based on server
        let apiDomain = "https://api.worldoftanks.eu/wot";
        
        switch(server) {
          case "NA":
            apiDomain = "https://api.worldoftanks.com/wot";
            break;
          case "ASIA":
            apiDomain = "https://api.worldoftanks.asia/wot";
            break;
        }
        
        // Expand fields to get all emblem sizes
        const url = `${apiDomain}/clans/info/?application_id=${CONFIG.WOT_API_KEY}&clan_id=${clanId}&fields=tag,name,emblems.x24,emblems.x32,emblems.x64,emblems.x195,emblems.x256`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.status === 'ok' && data.data && data.data[clanId]) {
          return data.data[clanId];
        }
        
        return null;
      } catch (error) {
        console.error('Error getting clan info:', error);
        return null;
      }
    }

    // Display player information
    function displayPlayerInfo() {
      if (!currentPlayer) return;
      
      const playerInfoDiv = document.getElementById('player-info');
      let html = '<div class="player-info-container">';
      
      // Player main info
      html += '<div class="player-info-main">';
      
      // Avatar (clan emblem or first letter of nickname)
      html += '<div class="player-avatar">';
      if (currentPlayer.details && currentPlayer.details.clan) {
        // If player is in a clan, use clan emblem
        if (currentPlayer.details.clan.emblems && currentPlayer.details.clan.emblems.x195) {
          html += `<img src="${currentPlayer.details.clan.emblems.x195.portal}" alt="Clan avatar">`;
        } else {
          html += `<div class="avatar-placeholder">${currentPlayer.nickname.charAt(0).toUpperCase()}</div>`;
        }
      } else {
        // If player is not in a clan, display first letter of nickname
        html += `<div class="avatar-placeholder">${currentPlayer.nickname.charAt(0).toUpperCase()}</div>`;
      }
      html += '</div>';
      
      html += '<div class="player-details">';
      html += `<div class="player-name">${currentPlayer.nickname}</div>`;
      
      // Clan (if exists)
      if (currentPlayer.details && currentPlayer.details.clan) {
        html += `<div class="player-clan">[${currentPlayer.details.clan.tag}] ${currentPlayer.details.clan.name}</div>`;
      }
      
      // Last battle
      if (currentPlayer.details && currentPlayer.details.last_battle_time) {
        const lastBattleTime = new Date(currentPlayer.details.last_battle_time * 1000);
        const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
        html += `<div class="player-last-battle">
          <span class="material-symbols-rounded">schedule</span>
          Last battle: ${lastBattleTime.toLocaleDateString('en-US', dateOptions)}
        </div>`;
      }
      
      html += '</div>'; // player-details
      html += '</div>'; // player-info-main
      
      // Player statistics
      if (currentPlayer.details && currentPlayer.details.statistics && currentPlayer.details.statistics.all) {
        const stats = currentPlayer.details.statistics.all;
        
        html += '<div class="stats-grid">';
        
        // Key metrics
        html += createStatCard('Battles', stats.battles.toLocaleString(), 'directions_car');
        html += createStatCard('Win Rate', `${(stats.wins / stats.battles * 100).toFixed(2)}%`, 'emoji_events', getWinrateColor(stats.wins / stats.battles * 100));
        html += createStatCard('Avg. Damage', (stats.damage_dealt / stats.battles).toFixed(0), 'bolt');
        html += createStatCard('Avg. Frags', (stats.frags / stats.battles).toFixed(2), 'whatshot');
        html += createStatCard('Avg. Spotting', (stats.spotted / stats.battles).toFixed(2), 'visibility');
        html += createStatCard('Defense Points', (stats.dropped_capture_points / stats.battles).toFixed(1), 'shield');
        
        html += '</div>'; // stats-grid
      }
      
      html += '</div>'; // player-info-container
      
      playerInfoDiv.innerHTML = html;
    }

    // Create stat card
    function createStatCard(label, value, icon, color = null) {
      const colorStyle = color ? `color: ${color};` : '';
      
      return `
      <div class="stat-card">
        <div class="stat-icon">
          <span class="material-symbols-rounded">${icon}</span>
        </div>
        <div class="stat-info">
          <div class="stat-value" style="${colorStyle}">${value}</div>
          <div class="stat-label">${label}</div>
        </div>
      </div>
      `;
    }

    // Load player's recent battles from Tomato.gg
    async function loadPlayerBattles() {
      if (!currentPlayer) {
        showMessage('Please find a player first', 'error');
        return;
      }
      
      // Get query parameters
      const battles = document.getElementById('battles-range').value;
      const days = document.getElementById('days-range').value;
      
      // Show loading indicator
      document.getElementById('battles-list-card').style.display = 'block';
      document.getElementById('loader-container').style.display = 'flex';
      document.getElementById('tanks-list').style.display = 'none';
      document.getElementById('stats-summary').style.display = 'none';
      
      // Update loading text
      document.getElementById('battles-loading-text').textContent = 
        `Loading battles for ${currentPlayer.nickname} (${currentPlayer.server})...`;
      
      try {
        // Disable load button
        loadBattlesBtn.disabled = true;
        loadBattlesBtn.innerHTML = '<span class="material-symbols-rounded">hourglass_empty</span> Loading...';
        
        // Load battles from Tomato.gg
        const battlesList = await getPlayerRecentBattlesFromTomato(
          currentPlayer.id, 
          currentPlayer.server, 
          document.getElementById('days-range').value,
          document.getElementById('battles-range').value
        );
        
        // Store battles
        playerBattles = battlesList;
        originalBattles = [...battlesList]; // Copy for filtering
        
        // Display battles
        displayPlayerBattles(battlesList);
        
        showMessage(`Loaded statistics for the last ${document.getElementById('days-range').value} days`, 'success');
      } catch (error) {
        console.error('Error loading battles:', error);
        
        // Show error message
        const tanksListDiv = document.getElementById('tanks-list');
        tanksListDiv.style.display = 'block';
        tanksListDiv.innerHTML = `
          <div class="error-container">
            <div class="error-icon"><span class="material-symbols-rounded">error</span></div>
            <div class="error-message">Failed to load data</div>
            <div class="error-description">${error.message}</div>
            <div class="error-help">
              Try refreshing the page or check your internet connection.
              The Tomato.gg service may also be temporarily unavailable.
            </div>
          </div>
        `;
        
        document.getElementById('stats-summary').style.display = 'none';
        document.getElementById('loader-container').style.display = 'none';
        
        showMessage('Error loading battles: ' + error.message, 'error');
      } finally {
        // Restore load button
        loadBattlesBtn.disabled = false;
        loadBattlesBtn.innerHTML = '<span class="material-symbols-rounded">download</span> Load Battles';
      }
    }

    // Get recent battles from Tomato.gg
    async function getPlayerRecentBattlesFromTomato(accountId, server = 'EU', days = 3, battlesLimit = 100) {
      try {
        // Build updated Tomato.gg API URL
        // Using direct URL to player battles instead of recents
        const url = `https://api.tomato.gg/dev/api-v2/player/battles/${accountId}?page=0&days=${days}&battleType=random&pageSize=${battlesLimit}&sortBy=battle_time&sortDirection=desc&platoon=in-and-outside-platoon&spawn=all&won=all&classes=false,false,false,false,false&nations=false,false,false,false,false,false,false,false,false,false,false&tiers=false,false,false,false,false,false,false,false,false,false&tankType=all`;
        
        console.log(`Request to Tomato.gg API: ${url}`);
        
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`HTTP error: ${response.status} ${response.statusText}`);
        }
        
        const data = await response.json();
        
        console.log(`Received response from Tomato.gg API:`, data.meta);
        
        if (!data.data || data.data.length === 0) {
          throw new Error('No battle data available');
        }
        
        // Process battle data
        const battles = data.data;
        
        // Group battles by tank
        const tanksMap = new Map();
        
        battles.forEach(battle => {
          const tankId = battle.id;
          const tankName = battle.name || 'Unknown tank';
          const tankType = battle.type || 'unknown';
          const tier = battle.tier || 0;
          
          const key = `${tankName}_${tankType}_${tier}`;
          
          if (tanksMap.has(key)) {
            const existingBattle = tanksMap.get(key);
            
            // Update statistics
            existingBattle.battles += 1;
            existingBattle.damage += battle.damage || 0;
            existingBattle.frags += battle.frags || 0;
            
            // Calculate winrate
            if (battle.won) {
              existingBattle.wins += 1;
            }
            
            // Update average metrics
            existingBattle.winrate = (existingBattle.wins / existingBattle.battles) * 100;
            existingBattle.dpg = existingBattle.damage / existingBattle.battles;
            existingBattle.kpg = existingBattle.frags / existingBattle.battles;
          } else {
            tanksMap.set(key, {
              tank: tankName,
              tankType: tankType,
              tier: tier,
              damage: battle.damage || 0,
              frags: battle.frags || 0,
              battles: 1,
              wins: battle.won ? 1 : 0,
              winrate: battle.won ? 100 : 0,
              dpg: battle.damage || 0,
              kpg: battle.frags || 0
            });
          }
        });
        
        console.log(`Grouped ${tanksMap.size} unique tanks`);
        
        return Array.from(tanksMap.values());
      } catch (error) {
        console.error('Error loading battles:', error);
        throw new Error(`Failed to load battles from Tomato.gg: ${error.message}`);
      }
    }

    // Display player battles
    function displayPlayerBattles(battles) {
      // Hide loading indicator
      document.getElementById('loader-container').style.display = 'none';
      document.getElementById('tanks-list').style.display = 'grid';
      document.getElementById('stats-summary').style.display = 'block';
      
      const tanksListDiv = document.getElementById('tanks-list');
      
      if (battles.length === 0) {
        tanksListDiv.innerHTML = '<div class="loading-text">No data for recent battles</div>';
        
        // Clear statistics
        document.getElementById('total-battles').textContent = '0';
        document.getElementById('avg-winrate').textContent = '0%';
        document.getElementById('avg-damage').textContent = '0';
        document.getElementById('avg-frags').textContent = '0';
        
        return;
      }
      
      let html = '';
      
      // Calculate summary statistics
      let totalBattles = 0;
      let totalDamage = 0;
      let weightedWinrate = 0;
      let totalFrags = 0;
      
      // Sort tanks by number of battles (most to least)
      battles.sort((a, b) => b.battles - a.battles);
      
      battles.forEach(battle => {
        // Update summary statistics
        totalBattles += battle.battles;
        totalDamage += battle.damage;
        weightedWinrate += battle.winrate * battle.battles; // Weighted average
        totalFrags += battle.frags;
        
        // Determine winrate color
        let winrateColor = getWinrateColor(battle.winrate);
        
        // Get tank type icon
        const tankTypeIcon = getTankTypeIcon(battle.tankType);
        
        // Add tank card
        html += `
        <div class="tank-card">
          <div class="tank-header">
            <div class="tank-name">${battle.tank}</div>
            <div class="tank-tier">${battle.tier}</div>
          </div>
          <div class="tank-type">
            <span class="material-symbols-rounded">${tankTypeIcon}</span>
            ${getTankTypeLabel(battle.tankType)}
          </div>
          
          <div class="tank-stats">
            <div class="tank-stat-item">
              <div class="tank-stat-value">${battle.battles}</div>
              <div class="tank-stat-label">Battles</div>
            </div>
            <div class="tank-stat-item">
              <div class="tank-stat-value" style="color: ${winrateColor};">${battle.winrate.toFixed(2)}%</div>
              <div class="tank-stat-label">Win Rate</div>
            </div>
            <div class="tank-stat-item">
              <div class="tank-stat-value">${battle.dpg.toFixed(0)}</div>
              <div class="tank-stat-label">Avg. Damage</div>
            </div>
            <div class="tank-stat-item">
              <div class="tank-stat-value">${battle.kpg.toFixed(2)}</div>
              <div class="tank-stat-label">Avg. Frags</div>
            </div>
          </div>
          
          <div class="progress-bar-container">
            <div class="progress-bar" style="width: ${battle.winrate}%; background-color: ${winrateColor};"></div>
          </div>
        </div>
        `;
      });
      
      tanksListDiv.innerHTML = html;
      
      // Update summary statistics
      const avgWinrate = weightedWinrate / totalBattles;
      const avgDamage = totalDamage / totalBattles;
      const avgFrags = totalFrags / totalBattles;
      
      document.getElementById('total-battles').textContent = totalBattles.toLocaleString();
      document.getElementById('avg-winrate').textContent = avgWinrate.toFixed(2) + '%';
      document.getElementById('avg-damage').textContent = avgDamage.toFixed(0);
      document.getElementById('avg-frags').textContent = avgFrags.toFixed(2);
      
      // Set winrate color
      document.getElementById('avg-winrate').style.color = getWinrateColor(avgWinrate);
    }

    // Filter battles
    function filterBattles() {
      if (!originalBattles || originalBattles.length === 0) return;
      
      const tankType = document.getElementById('tank-type-filter').value;
      const tier = document.getElementById('tier-filter').value;
      
      // Clone original battles
      let filteredBattles = [...originalBattles];
      
      // Filter by tank type
      if (tankType !== 'all') {
        filteredBattles = filteredBattles.filter(battle => battle.tankType === tankType);
      }
      
      // Filter by tier
      if (tier !== 'all') {
        filteredBattles = filteredBattles.filter(battle => battle.tier.toString() === tier);
      }
      
      // Display filtered battles
      displayPlayerBattles(filteredBattles);
    }

    // Get tank type label
    function getTankTypeLabel(type) {
      switch(type) {
        case 'HT': return 'Heavy Tank';
        case 'MT': return 'Medium Tank';
        case 'TD': return 'Tank Destroyer';
        case 'LT': return 'Light Tank';
        case 'SPG': return 'Artillery';
        default: return type;
      }
    }
    
    // Get tank type icon
    function getTankTypeIcon(type) {
      switch(type) {
        case 'HT': return 'shield';
        case 'MT': return 'directions_car';
        case 'TD': return 'gps_fixed';
        case 'LT': return 'speed';
        case 'SPG': return 'rocket_launch';
        default: return 'help';
      }
    }

    // Get winrate color
    function getWinrateColor(winrate) {
      if (winrate >= 65) return 'var(--rating-unicum)'; // Unicum
      if (winrate >= 60) return 'var(--rating-super)';  // Super Unicum
      if (winrate >= 56) return 'var(--rating-great)';  // Great
      if (winrate >= 53) return 'var(--rating-good)';   // Good
      if (winrate >= 50) return 'var(--rating-average)'; // Average
      if (winrate >= 47) return 'var(--rating-below)';  // Below Average
      return 'var(--rating-bad)';                       // Bad
    }

    // Open Tomato.GG profile
    function openTomatoGGProfile() {
      if (!currentPlayer) {
        showMessage('Please find a player first', 'error');
        return;
      }
      
      const tomatoURL = `https://tomato.gg/stats/${currentPlayer.server}/${encodeURIComponent(currentPlayer.nickname)}-${currentPlayer.id}`;
      window.open(tomatoURL, '_blank');
    }

    // Open official WoT profile
    function openWotProfile() {
      if (!currentPlayer) {
        showMessage('Please find a player first', 'error');
        return;
      }
      
      let wotDomain = 'https://worldoftanks.eu';
      
      switch(currentPlayer.server) {
        case 'NA':
          wotDomain = 'https://worldoftanks.com';
          break;
        case 'ASIA':
          wotDomain = 'https://worldoftanks.asia';
          break;
      }
      
      const wotURL = `${wotDomain}/en/community/accounts/${currentPlayer.id}-${encodeURIComponent(currentPlayer.nickname)}/`;
      window.open(wotURL, '_blank');
    }

    // Show message
    function showMessage(message, type) {
      const errorEl = document.getElementById('error-message');
      const successEl = document.getElementById('success-message');
      
      // Hide all messages first
      errorEl.style.display = 'none';
      successEl.style.display = 'none';
      
      // Remove exit animation class if it exists
      errorEl.classList.remove('slide-out');
      successEl.classList.remove('slide-out');
      
      let alertEl;
      
      if (type === 'error') {
        alertEl = errorEl;
        // Update message content with icon
        alertEl.querySelector('.alert-message').textContent = message;
      } else {
        alertEl = successEl;
        // Update message content with icon
        alertEl.querySelector('.alert-message').textContent = message;
      }
      
      // Add close handler
      const closeBtn = alertEl.querySelector('.alert-close');
      if (closeBtn) {
        closeBtn.onclick = function() {
          hideMessage(alertEl);
        };
      }
      
      // Show message
      alertEl.style.display = 'block';
      
      // Auto-hide message after 5 seconds
      setTimeout(() => {
        hideMessage(alertEl);
      }, 5000);
    }

    // Smoothly hide message
    function hideMessage(element) {
      if (element && element.style.display !== 'none') {
        element.classList.add('slide-out');
        
        // Remove element after animation completes
        setTimeout(() => {
          element.style.display = 'none';
          element.classList.remove('slide-out');
        }, 300); // 300ms - animation duration
      }
    }

    // Initialize page on DOM content loaded
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>